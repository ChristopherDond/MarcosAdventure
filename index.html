<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcos Adventure - Ultra Edition</title>
    <style>
        :root {
            --neon-blue: #00f7ff;
            --neon-pink: #ff00ff;
            --neon-gold: #ffcc00;
            --neon-purple: #8800ff;
            --neon-red: #ff3131;
            --fury-color: #ff3300;
            --scanline: rgba(18, 16, 16, 0.1);
        }

        body {
            background-color: #020205;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', Courier, monospace;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #gameContainer::after {
            content: " ";
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(var(--scanline) 50%, rgba(0, 0, 0, 0.1) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
            z-index: 50;
        }

        #gameContainer {
            position: relative;
            border: 4px solid #1a1a1a;
            border-radius: 4px;
            box-shadow: 0 0 40px rgba(0, 247, 255, 0.1), inset 0 0 20px rgba(0,0,0,0.5);
            background: #000;
            overflow: hidden;
            max-width: 95vw;
            max-height: 90vh;
        }

        canvas { display: block; cursor: crosshair; filter: saturate(1.2) contrast(1.1); max-width: 100%; height: auto; }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 60;
        }

        .stat-box {
            background: rgba(0, 0, 5, 0.7);
            padding: 10px 15px;
            border: 1px solid rgba(0, 247, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 247, 255, 0.1);
            backdrop-filter: blur(5px);
            text-transform: uppercase;
        }

        .hp-bar-bg {
            width: 150px;
            height: 12px;
            background: rgba(255,255,255,0.1);
            margin-top: 5px;
            border: 1px solid #333;
        }

        #hp-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #0088ff, var(--neon-blue), #ffffff);
            background-size: 200% 100%;
            animation: flow 2s linear infinite;
            transition: width 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        @keyframes flow { 0% { background-position: 0% 50%; } 100% { background-position: -200% 50%; } }

        .boss-ui { border-color: rgba(255, 0, 255, 0.3); text-align: right; }

        #victoryScreen, #startScreen {
            display: none;
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid var(--neon-gold);
            width: 80%;
        }

        #startScreen { display: block; border-color: var(--neon-blue); }

        .glitch-text { 
            color: var(--neon-gold); 
            font-size: 3em;
            text-shadow: 3px 3px var(--neon-pink), -3px -3px var(--neon-blue);
            margin: 0 0 20px 0;
        }

        button {
            padding: 15px 50px;
            cursor: pointer;
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            font-family: inherit;
            font-weight: bold;
            transition: 0.2s;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        }
        button:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 40px var(--neon-blue); }

        #furyAlert {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-weight: bold;
            font-size: 20px;
            padding: 5px 20px;
            background: var(--fury-color);
            display: none;
            z-index: 70;
            clip-path: polygon(5% 0, 95% 0, 100% 50%, 95% 100%, 5% 100%, 0 50%);
        }
    </style>
</head>
<body>

    <div id="gameContainer">
        <div id="furyAlert">OVERDRIVE ATIVADO</div>
        
        <div id="startScreen">
            <h1 class="glitch-text" style="color:var(--neon-blue)">MARCOS REVENGE</h1>
            <p style="color: var(--neon-blue); font-size: 12px; margin-bottom: 40px;">[ STATUS: OPERACIONAL ]</p>
            <button onclick="startGame()">CONECTAR</button>
        </div>

        <div id="ui">
            <div class="stat-box">
                <div>WEAPON: <span id="weaponLevel" style="color: var(--neon-blue);">LVL 1</span></div>
                <div class="hp-bar-bg"><div id="hp-fill"></div></div>
            </div>
            <div class="stat-box boss-ui">
                <div id="bossName" style="color: var(--neon-pink);">HOSTILE...</div>
                <div style="font-size: 22px; font-weight: bold;"><span id="bossHp">0</span>%</div>
            </div>
        </div>
        
        <canvas id="gameCanvas" width="1000" height="800"></canvas>

        <div id="victoryScreen">
            <h1 class="glitch-text">VITÓRIA SUPREMA</h1>
            <img id="victoryGif" style="max-width: 200px; border-radius: 50%; border: 4px solid var(--neon-gold); margin: 20px 0;">
            <p style="color: white;">A paz de Marcos foi restaurada em todo o Universo, foi salvo por Marcos!</p>
            <button onclick="location.reload()">REINICIAR</button>
        </div>
    </div>

    <div style="display:none;">
        <img id="playerImgSource" src="marcos4.jpg">
        <img id="imgQuecedisse" src="quecedisse.png">
        <img id="imgQuetristeza" src="quetristeza.png">
        <img id="imgBossAbsoluto" src="bossAbsoluto.png">
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq, type, duration, vol = 0.1) {
        try {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        } catch(e) {}
    }

    let gameState = 'start';
    let frames = 0;
    let shake = 0;
    let particles = [];
    let bullets = [];
    let items = [];
    let currentBossIdx = 0;
    let bosses = [];

    const keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false, w: false, s: false, a: false, d: false, ' ': false };
    document.addEventListener('keydown', (e) => { if(keys.hasOwnProperty(e.key)) keys[e.key] = true; });
    document.addEventListener('keyup', (e) => { if(keys.hasOwnProperty(e.key)) keys[e.key] = false; });

    class Particle {
        constructor(x, y, color, size = 3, speed = 8) {
            this.x = x; this.y = y;
            this.color = color;
            this.size = Math.random() * size + 1;
            this.vx = (Math.random() - 0.5) * speed;
            this.vy = (Math.random() - 0.5) * speed;
            this.life = 1.0;
            this.decay = Math.random() * 0.03 + 0.02;
        }
        update() { this.x += this.vx; this.y += this.vy; this.life -= this.decay; }
        draw() {
            ctx.globalAlpha = this.life;
            ctx.fillStyle = this.color;
            ctx.shadowBlur = 8; ctx.shadowColor = this.color;
            ctx.fillRect(this.x, this.y, this.size, this.size);
            ctx.globalAlpha = 1; ctx.shadowBlur = 0;
        }
    }

    class Player {
        constructor() {
            this.width = 50; this.height = 50;
            this.x = canvas.width/2 - 25; this.y = canvas.height - 100;
            this.speed = 7; this.hp = 100;
            this.weaponLevel = 1; this.lastShot = 0; this.shootDelay = 180;
            this.furyMode = 0; 
        }
        takeDamage(amount) {
            if (this.furyMode <= 0) {
                this.hp -= amount;
                shake = 12;
                if(frames % 5 === 0) playSound(50, 'square', 0.2);
                for(let i=0; i<5; i++) particles.push(new Particle(this.x+25, this.y+25, 'red', 4));
            }
        }
        update() {
            let moveX = 0, moveY = 0;
            if (keys.ArrowUp || keys.w) moveY -= this.speed;
            if (keys.ArrowDown || keys.s) moveY += this.speed;
            if (keys.ArrowLeft || keys.a) moveX -= this.speed;
            if (keys.ArrowRight || keys.d) moveX += this.speed;
            if (moveX !== 0 && moveY !== 0) { moveX *= 0.707; moveY *= 0.707; }

            this.x = Math.max(0, Math.min(canvas.width - this.width, this.x + moveX));
            this.y = Math.max(0, Math.min(canvas.height - this.height, this.y + moveY));

            if (this.furyMode > 0) {
                this.furyMode--;
                document.getElementById('furyAlert').style.display = 'block';
                if (frames % 2 === 0) particles.push(new Particle(this.x + Math.random()*50, this.y + 50, '#ff3300', 4, 4));
            } else {
                document.getElementById('furyAlert').style.display = 'none';
            }

            if (frames % 4 === 0) particles.push(new Particle(this.x + this.width/2, this.y + this.height, '#00f7ff', 2, 2));

            if (keys[' '] && Date.now() - this.lastShot > (this.furyMode > 0 ? 90 : this.shootDelay)) {
                this.shoot();
                this.lastShot = Date.now();
            }
        }
        draw() {
            ctx.save();
            if (this.furyMode > 0) {
                ctx.shadowBlur = 30; ctx.shadowColor = '#ff3300';
                ctx.filter = `hue-rotate(${frames * 5}deg) brightness(1.5)`;
            } else {
                ctx.shadowBlur = 15; ctx.shadowColor = '#00f7ff';
            }
            try { ctx.drawImage(document.getElementById('playerImgSource'), this.x, this.y, this.width, this.height); }
            catch(e) { ctx.fillStyle = '#00f7ff'; ctx.fillRect(this.x, this.y, this.width, this.height); }
            ctx.restore();
        }
        shoot() {
            const isFury = this.furyMode > 0;
            const color = isFury ? '#ff3300' : (this.weaponLevel >= 4 ? '#ffcc00' : '#00f7ff');
            playSound(isFury ? 400 : 200 + (this.weaponLevel * 50), 'square', 0.1);
            const mx = this.x + this.width/2 - 3;
            let lvl = isFury ? 4 : this.weaponLevel;

            if (lvl === 1) {
                bullets.push(new Bullet(mx, this.y, -12, 'player', color));
            } else if (lvl === 2) {
                bullets.push(new Bullet(mx - 15, this.y, -11, 'player', color));
                bullets.push(new Bullet(mx + 15, this.y, -11, 'player', color));
            } else if (lvl === 3) {
                bullets.push(new Bullet(mx, this.y, -12, 'player', color));
                bullets.push(new Bullet(mx - 20, this.y, -10, 'player', color, -1.5));
                bullets.push(new Bullet(mx + 20, this.y, -10, 'player', color, 1.5));
            } else {
                for(let i=-2; i<=2; i++) {
                    bullets.push(new Bullet(mx, this.y, -10, 'player', color, i*2.5));
                }
            }
        }
    }

    class Bullet {
        constructor(x, y, vY, owner, color, vX = 0) {
            this.x = x; this.y = y; this.vY = vY; this.vX = vX;
            this.owner = owner; this.color = color;
            this.width = 5; this.height = 15;
            this.markedForDeletion = false;
        }
        update() {
            this.y += this.vY; this.x += this.vX;
            if (this.y < -50 || this.y > canvas.height + 50) this.markedForDeletion = true;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.shadowBlur = 10; ctx.shadowColor = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.shadowBlur = 0;
        }
    }

    class Boss {
        constructor(name, maxHp, color, img) {
            this.name = name; this.maxHp = maxHp; this.hp = maxHp;
            this.color = color; this.img = img;
            this.x = canvas.width/2 - 75; this.y = -200;
            this.width = 150; this.height = 100;
            this.timer = 0;
            this.flash = 0;
        }
        takeDamage() {
            const damageFactor = player.furyMode > 0 ? 0.04 : 0.025;
            this.hp -= (this.maxHp * damageFactor);
            this.flash = 5;
            shake = 6;
            playSound(100, 'sawtooth', 0.05, 0.05);
            for(let i=0; i<5; i++) particles.push(new Particle(this.x + Math.random()*this.width, this.y + Math.random()*this.height, this.color));
        }
        drawHP() {
            const displayHp = Math.max(0, Math.floor((this.hp / this.maxHp) * 100));
            document.getElementById('bossHp').innerText = displayHp;
            document.getElementById('bossName').innerText = this.name;
        }
        applyFlash() {
            if (this.flash > 0) {
                ctx.filter = 'brightness(5) contrast(2)';
                this.flash--;
            }
        }
        checkPlayerCollision(p) {
            if(intersect(p, this)) p.takeDamage(0.5);
        }
    }

    class Boss1 extends Boss {
        update() {
            if(this.y < 80) this.y += 2;
            this.timer++;
            this.x = (canvas.width/2 - this.width/2) + Math.sin(this.timer * 0.03) * 350;
            if(this.timer % 40 === 0) {
                bullets.push(new Bullet(this.x + this.width/2, this.y + this.height, 6, 'boss', 'red'));
                playSound(80, 'sine', 0.2);
            }
            this.checkPlayerCollision(player);
        }
        draw() {
            ctx.save();
            this.applyFlash();
            ctx.shadowBlur = 25; ctx.shadowColor = this.color;
            ctx.drawImage(this.img, this.x, this.y, this.width, this.height);
            ctx.restore(); ctx.filter = 'none';
            this.drawHP();
        }
    }

    class Boss2 extends Boss {
        update() {
            if(this.y < 100) this.y += 2;
            this.timer += 0.05;
            if(frames % 25 === 0) {
                const bx = this.x + 75 + Math.cos(this.timer)*100;
                const by = this.y + 50 + Math.sin(this.timer)*100;
                bullets.push(new Bullet(bx, by, 5, 'boss', '#ff9900'));
            }
            this.checkPlayerCollision(player);
        }
        draw() {
            const x1 = this.x + Math.cos(this.timer) * 150, y1 = this.y + Math.sin(this.timer) * 150;
            const x2 = this.x + Math.cos(this.timer + Math.PI) * 150, y2 = this.y + Math.sin(this.timer + Math.PI) * 150;
            ctx.save(); this.applyFlash();
            ctx.shadowBlur = 15; ctx.shadowColor = '#ff9900';
            ctx.drawImage(this.img, x1, y1, 90, 90);
            ctx.drawImage(this.img, x2, y2, 90, 90);
            ctx.restore(); ctx.filter = 'none';
            this.drawHP();
        }
        checkPlayerCollision(p) {
            const x1 = this.x + Math.cos(this.timer) * 150, y1 = this.y + Math.sin(this.timer) * 150;
            const x2 = this.x + Math.cos(this.timer + Math.PI) * 150, y2 = this.y + Math.sin(this.timer + Math.PI) * 150;
            if(intersect(p, {x:x1, y:y1, width:90, height:90}) || intersect(p, {x:x2, y:y2, width:90, height:90})) {
                p.takeDamage(0.5);
            }
        }
        checkCollision(rect) {
            const x1 = this.x + Math.cos(this.timer) * 150, y1 = this.y + Math.sin(this.timer) * 150;
            const x2 = this.x + Math.cos(this.timer + Math.PI) * 150, y2 = this.y + Math.sin(this.timer + Math.PI) * 150;
            return (intersect(rect, {x:x1, y:y1, width:90, height:90}) || intersect(rect, {x:x2, y:y2, width:90, height:90}));
        }
    }

    class Boss3 extends Boss {
        constructor(n, h, c, i) { super(n,h,c,i); this.width = 300; this.height = 200; }
        update() {
            this.timer++;
            this.y = 100 + Math.sin(this.timer * 0.04) * 60;
            this.x = (canvas.width/2 - this.width/2) + Math.sin(this.timer * 0.02) * 300;
            if(this.timer % 45 === 0) {
                for(let i=-3; i<=3; i++) bullets.push(new Bullet(this.x + this.width/2, this.y + this.height, 4, 'boss', '#bc13fe', i*3));
                playSound(60, 'sawtooth', 0.3);
            }
            this.checkPlayerCollision(player);
        }
        draw() {
            ctx.save(); this.applyFlash();
            ctx.shadowBlur = 40; ctx.shadowColor = 'purple';
            ctx.drawImage(this.img, this.x, this.y, this.width, this.height);
            ctx.restore(); ctx.filter = 'none';
            this.drawHP();
        }
    }

    const intersect = (r1, r2) => !(r2.x > r1.x + r1.width || r2.x + r2.width < r1.x || r2.y > r1.y + r1.height || r2.y + r2.height < r1.y);

    let player = new Player();

    function startGame() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        document.getElementById('startScreen').style.display = 'none';
        bosses = [
            new Boss1("O QUE CÊ DISSE?", 200, '#ff4444', document.getElementById('imgQuecedisse')),
            new Boss2("QUE TRISTEZA", 450, '#ff9900', document.getElementById('imgQuetristeza')),
            new Boss3("MARCOS ABSOLUTO", 900, '#8800ff', document.getElementById('imgBossAbsoluto'))
        ];
        gameState = 'playing';
        loop();
    }

    function loop() {
        if(gameState !== 'playing') return;
        frames++;
        ctx.save();
        if(shake > 0) { ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2); shake *= 0.9; }

        ctx.fillStyle = '#050508';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'rgba(255,255,255,0.5)';
        for(let i=0; i<60; i++) {
            let sX = (i * 137) % canvas.width;
            let sY = (i * 159 + frames * (i%3 + 1)) % canvas.height;
            ctx.fillRect(sX, sY, 1.5, 1.5);
        }

        player.update();
        let boss = bosses[currentBossIdx];
        if(boss) boss.update();

        if (frames % 400 === 0) {
            const types = ['heal', 'multishot', 'fury'];
            items.push({ x: Math.random()*(canvas.width-30), y: -50, type: types[Math.floor(Math.random()*3)], size: 25 });
        }

        items.forEach((it, idx) => {
            it.y += 3.5;
            ctx.save(); ctx.shadowBlur = 15;
            ctx.fillStyle = it.type === 'heal' ? '#00ff00' : it.type === 'multishot' ? '#ffff00' : '#ff3300';
            ctx.shadowColor = ctx.fillStyle;
            ctx.beginPath(); ctx.arc(it.x + 12, it.y + 12, 12 + Math.sin(frames*0.15)*4, 0, Math.PI*2);
            ctx.fill(); ctx.restore();

            if(intersect(player, {x:it.x, y:it.y, width:25, height:25})) {
                if(it.type === 'heal') player.hp = Math.min(100, player.hp + 30);
                if(it.type === 'multishot') player.weaponLevel = Math.min(4, player.weaponLevel + 1);
                if(it.type === 'fury') { player.furyMode = 300; playSound(800, 'sawtooth', 0.5); }
                else playSound(600, 'sine', 0.2);
                items.splice(idx, 1);
            }
        });

        bullets.forEach((b) => {
            b.update();
            if(b.owner === 'player') {
                if(boss && (boss.checkCollision ? boss.checkCollision(b) : intersect(b, boss))) {
                    boss.takeDamage();
                    b.markedForDeletion = true;
                }
            } else if(intersect(b, player)) {
                player.takeDamage(10);
                b.markedForDeletion = true;
            }
        });

        if(boss && boss.hp <= 0) {
            playSound(150, 'sawtooth', 0.5);
            shake = 20;
            for(let i=0; i<60; i++) particles.push(new Particle(boss.x+boss.width/2, boss.y+boss.height/2, boss.color, 10));
            currentBossIdx++;
            if(currentBossIdx >= bosses.length) { gameState = 'victory'; showVictory(); }
            else { player.hp = Math.min(100, player.hp + 40); }
        }

        if(player.hp <= 0) { 
            gameState = 'gameOver';
            location.reload(); 
        }

        bullets = bullets.filter(b => !b.markedForDeletion);
        particles.forEach((p, i) => { p.update(); if(p.life <= 0) particles.splice(i,1); else p.draw(); });
        bullets.forEach(b => b.draw());
        player.draw();
        if(boss) boss.draw();

        document.getElementById('hp-fill').style.width = player.hp + '%';
        const levelText = player.furyMode > 0 ? "FÚRIA TOTAL" : `NÍVEL ${player.weaponLevel}`;
        document.getElementById('weaponLevel').innerText = levelText;
        document.getElementById('weaponLevel').style.color = player.furyMode > 0 ? 'var(--fury-color)' : 'var(--neon-blue)';

        ctx.restore();
        if(gameState === 'playing') requestAnimationFrame(loop);
    }

    function showVictory() {
        document.getElementById('ui').style.display = 'none';
        document.getElementById('victoryScreen').style.display = 'block';
        document.getElementById('victoryGif').src = "marcos1.gif";
    }
</script>
</body>
</html>